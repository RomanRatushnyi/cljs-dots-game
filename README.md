# Игра "Точки" - ClojureScript версия

Многопользовательская игра в реальном времени по захвату точек, построенная на ClojureScript, Reagent и Socket.IO.

## Возможности

- Многопользовательский геймплей в реальном времени
- Функциональное программирование на ClojureScript
- Реактивный UI с использованием Reagent
- WebSocket коммуникация через Socket.IO
- Node.js сервер, скомпилированный из ClojureScript
- Иммутабельное состояние игры

## Требования

- Java 8+ (для Clojure)
- Node.js (версия 14 или выше)
- npm или yarn
- Clojure CLI tools

## Установка

1. Перейдите в директорию проекта:
   ```bash
   cd cljs-dots-game
   ```

2. Установите JavaScript зависимости:
   ```bash
   npm install
   ```

3. Установите Shadow CLJS глобально (опционально):
   ```bash
   npm install -g shadow-cljs
   ```

## Запуск проекта

### Режим разработки

Для одновременного запуска клиента и сервера в режиме разработки:

```bash
npm run dev-all
```

Или запустите отдельно:

1. Запуск клиентской части (авто-компиляция):
   ```bash
   npm run dev
   ```

2. Запуск серверной части (в другом терминале):
   ```bash
   npm run server
   ```

3. Запуск скомпилированного сервера:
   ```bash
   npm start
   ```

### Продакшн режим

1. Скомпилируйте клиентскую часть:
   ```bash
   npm run build
   ```

2. Скомпилируйте серверную часть:
   ```bash
   npm run server-release
   ```

3. Запустите сервер:
   ```bash
   npm start
   ```

### Ручная сборка

Если у вас установлен Shadow CLJS глобально:

```bash
# Разработка
shadow-cljs watch app
shadow-cljs watch server

# Продакшн
shadow-cljs release app
shadow-cljs release server
```

## Доступ к игре

После запуска откройте браузер и перейдите по адресу:

```
http://localhost:8080
```

Сервер Socket.IO работает на порту 3000.

## Структура проекта

```
cljs-dots-game/
├── deps.edn                 # Clojure зависимости
├── shadow-cljs.edn          # Конфигурация Shadow CLJS
├── package.json             # Node.js зависимости и скрипты
├── public/
│   └── index.html          # HTML страница
├── src/
│   └── cljs_dots_game/
│       ├── core.cljs       # Главный клиентский модуль
│       ├── game.cljs       # Логика игры
│       ├── server.cljs     # Серверный код
│       └── types.cljs      # Типы и константы
└── server.js               # Скомпилированный сервер (после сборки)
```

## Правила игры

### Основная механика

Игра происходит на поле с клетками в виде сетки. Цель игры - захватить как можно больше территории, окружая точки противника своими точками.

### Как захватываются точки

1. **Размещение точек**: Игроки по очереди размещают свои точки на пустых клетках
2. **Окружение**: Когда группа точек противника полностью окружена вашими точками, она захватывается
3. **Захват**: Захваченные точки помечаются специальным символом и добавляются к счету

### Как добавляется очко

- **1 очко** за каждую захваченную точку противника
- **Дополнительный ход**: При захвате игрок получает право на дополнительный ход
- **Цепочки**: Можно захватывать несколько групп за один ход

### Как определяется победитель

1. **Подсчет очков**: Суммируются все захваченные точки
2. **Победитель**: Игрок с наибольшим количеством очков
3. **Ничья**: При равном количестве очков

### Когда игра заканчивается

1. **Заполнение поля**: Когда остается мало свободных клеток (менее 10%)
2. **Добровольный выход**: Если игрок покидает игру
3. **Тайм-аут**: При длительном отсутствии ходов

## Технические особенности ClojureScript версии

### Функциональное программирование

- **Иммутабельные данные**: Все состояние игры неизменяемо
- **Чистые функции**: Логика игры реализована через чистые функции
- **Композиция функций**: Сложная логика строится из простых функций

### Реактивность

- **Reagent**: Реактивные компоненты для UI
- **Atoms**: Управление состоянием через атомы
- **Автообновление**: UI автоматически обновляется при изменении состояния

### Преимущества ClojureScript

- **Безопасность типов**: Во время компиляции
- **Простота отладки**: Благодаря неизменяемости данных
- **Производительность**: Оптимизация Google Closure Compiler
- **Интероперабельность**: Полная совместимость с JavaScript

## Команды разработки

```bash
# Очистка сборки
npm run clean

# Проверка зависимостей
clj -M:dev -m shadow.cljs.devtools.cli info

# REPL для разработки
shadow-cljs cljs-repl app

# Анализ размера сборки
shadow-cljs run shadow.cljs.build-report app report.html
```

## Устранение неполадок

- **Java не найдена**: Установите Java 8+
- **Clojure CLI не установлен**: Следуйте инструкциям на clojure.org
- **Ошибки компиляции**: Проверьте синтаксис ClojureScript
- **Порты заняты**: Измените порты в shadow-cljs.edn
- **Долгая первая сборка**: Это нормально для ClojureScript

## Отличия от TypeScript версии

1. **Синтаксис**: Lisp-подобный синтаксис вместо C-подобного
2. **Парадигма**: Функциональное программирование вместо ОПП
3. **Состояние**: Иммутабельные структуры данных
4. **Компиляция**: Closure Compiler оптимизация
5. **REPL**: Интерактивная разработка
